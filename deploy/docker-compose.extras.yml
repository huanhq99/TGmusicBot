# 可选特性示例，搭配根目录 docker-compose.yml 使用：
# docker compose -f docker-compose.yml -f deploy/docker-compose.extras.yml up -d
services:
  tgmusicbot:
    # 将选配服务挂载到主服务
    networks:
      - tg-stack
    environment:
      - TELEGRAM_API_URL=http://telegram-bot-api:8081/bot
      - MUSIC_PROXY_URL=http://music-proxy:8088
      - MUSIC_PROXY_KEY=${MUSIC_PROXY_KEY}
    volumes:
      - ./watch:/watch                # 文件整理器监听目录
      - ./music:/music                # 文件整理目标目录

  telegram-bot-api:
    image: ghcr.io/aiogram/telegram-bot-api:latest
    restart: unless-stopped
    networks:
      - tg-stack
    environment:
      TELEGRAM_API_ID: ${TG_API_ID}
      TELEGRAM_API_HASH: ${TG_API_HASH}
      TELEGRAM_BOT_API_ID: ${TELEGRAM_BOT_API_ID:-0}
      TELEGRAM_BOT_API_LOCAL: "1"
    ports:
      - "8081:8081"
    volumes:
      - ./data/telegram-bot-api:/var/lib/telegram-bot-api
    # 建议在外层反代里做 Basic Auth 或 IP 白名单

  music-proxy:
    image: your-org/music-proxy:latest
    restart: unless-stopped
    networks:
      - tg-stack
    environment:
      - MUSIC_PROXY_TOKEN=${MUSIC_PROXY_KEY}
      - MUSIC_PROXY_UPSTREAM=https://music.163.com
    ports:
      - "8088:8088"
    # 将 TELEGRAM_BOT 的 MUSIC_PROXY_URL 指向该服务

networks:
  tg-stack:
    driver: bridge
